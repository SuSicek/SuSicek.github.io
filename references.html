<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="UCHYTIL s.r.o. - Galerie projektů a referencí. Podívejte se na naše dokončené projekty v oblasti energetiky, stavebnictví a TZB.">
  <title>Galerie projektů - UCHYTIL s.r.o.</title>

  <!-- Global styles + subpage overrides -->
  <link rel="preload" href="../css/style.css" as="style">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/references.css">

  <link rel="icon" href="../fotky/logo.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js" defer></script>
  <script src="../js/content-loader.js"></script>
</head>
<body id="top">
  <!-- Header (same as main page) -->
  <header class="header" data-header>
    <div class="overlay" data-overlay></div>
    <div class="header-top">
      <div class="container">
        <a href="../html/index.html" class="logo">
          <img src="" alt="" loading="eager">
        </a>
        <div class="header-btn-group">
          <button class="nav-open-btn" aria-label="Open Menu" data-nav-open-btn>
            <ion-icon name="menu-outline"></ion-icon>
          </button>
        </div>
      </div>
    </div>
    <div class="header-bottom">
      <div class="container">
        <nav class="navbar" data-navbar>
          <div class="navbar-top">
            <a href="../html/index.html" class="logo">
              <img src="../fotky/logo.png" alt="" loading="lazy">
            </a>
            <button class="nav-close-btn" aria-label="Close Menu" data-nav-close-btn>
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>
          <div class="services-rolldown" id="servicesRolldown">
            <button class="services-trigger" id="servicesTrigger" aria-haspopup="true" aria-expanded="false" aria-controls="servicesPanel">
              <span class="services-trigger-label">Naše služby</span>
              <ion-icon name="chevron-down-outline" class="chevron"></ion-icon>
            </button>
            <ul class="services-panel" id="servicesPanel">
              <li><a href="division-template.html?division=energetika">Energetika</a></li>
              <li><a href="division-template.html?division=prumysl">TZB</a></li>
              <li><a href="division-template.html?division=stavebnictvi">Stavebnictví</a></li>
              <li><a href="eshop.html">E-shop</a></li>
            </ul>
          </div>
          <ul class="navbar-list">
            <!-- Navigation items will be loaded from JSON -->
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <!-- Slideshow hero (same as main page) -->
    <section class="hero-section" id="home">
      <div class="slideshow">
        <!-- Slides will be loaded from JSON -->
      </div>
    </section>

    <!-- References subpage -->
    <section class="references" id="references">
      <div class="container">
        <p class="section-subtitle">naše realizace</p>
        <h2 class="h2 section-title">Reference a dokončené projekty</h2>
        <p class="section-text">Podívejte se na projekty, které demonstrují naši odbornost a kvalitu práce v energetice, stavebnictví a TZB.</p>

        <!-- Optional filters/sort (projects-loader.js can hook in if needed) -->
        <div class="ref-controls">
          <div class="ref-search">
            <ion-icon name="search-outline" aria-hidden="true"></ion-icon>
            <input type="search" id="refSearch" placeholder="Hledat projekt, lokalitu nebo klíčové slovo…" autocomplete="off" />
          </div>
          <div class="ref-filter-group">
            <label for="refDivision" style="font-weight:600;margin-right:8px;">Divize:</label>
            <select id="refDivision" class="ref-division-select">
              <option value="all">Všechny</option>
              <option value="energetika">Energetika</option>
              <option value="stavba">Stavba</option>
              <option value="tzb">TZB</option>
            </select>
          </div>
          <div class="ref-chips" id="refChips">
            <!-- Optional: chips injected by script -->
          </div>
        </div>

        <!-- Projects grid (populated dynamically) -->
        <div class="references-grid" id="projectsGrid">
          <!-- Cards will be injected by projects-loader.js -->
        </div>

        <div class="references-cta">
          <a class="references-btn" href="../html/contact-us.html">Chci podobný projekt</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal for project details -->
  <div class="references-modal" id="referencesModal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose" aria-label="Zavřít" style="color:#fff;background:rgba(34,86,161,0.25);">
        <ion-icon name="close-outline"></ion-icon>
      </button>
      <div class="modal-body">
        <div class="modal-gallery">
          <button type="button" class="modal-arrow left" id="modalPrev" aria-label="Předchozí obrázek" style="color:#fff;background:rgba(34,86,161,0.25);">
            <ion-icon name="chevron-back-outline"></ion-icon>
          </button>
          <img id="modalImage" src="" alt="" style="width:100%;height:100%;object-fit:cover;object-position:center;" />
          <button type="button" class="modal-arrow right" id="modalNext" aria-label="Další obrázek" style="color:#fff;background:rgba(34,86,161,0.25);">
            <ion-icon name="chevron-forward-outline"></ion-icon>
          </button>
        </div>
        <div class="modal-details">
          <div class="modal-title" id="modalTitle"></div>
          <div class="modal-meta">
            <span class="modal-category" id="modalCategory"></span>
            <span class="modal-year" id="modalYear"></span>
            <span class="modal-location" id="modalLocation"></span>
          </div>
          <div class="modal-description" id="modalDescription"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with integrated prefooter links (same as main page) -->
  <footer class="footer">
    <div class="footer-top">
      <div class="container">
        <div class="footer-brand">
          <a href="../index.html" class="logo"><img id="footer-logo" src="" alt="UCHYTIL s.r.o."></a>
        </div>
        <div class="footer-links">
          <div class="prefooter-groups">
            <div class="pf-group">
              <div class="pf-group-title">naše podstránky</div>
              <div class="pf-list">
                <a class="pf-card" href="aboutus.html"><h3 class="pf-title">O nás</h3></a>
                <a class="pf-card" href="projects.html"><h3 class="pf-title">Reference</h3></a>
                <a class="pf-card" href="contact-us.html"><h3 class="pf-title">Kontakty</h3></a>
                <a class="pf-card" href="eshop.html"><h3 class="pf-title">E‑Shop</h3></a>
                <a class="pf-card" href="division-template.html?division=energetika"><h3 class="pf-title">Divize</h3></a>
              </div>
            </div>
            <div class="pf-group">
              <div class="pf-group-title">jiné</div>
              <div class="pf-list">
                <a class="pf-card" href="ethics-code.html"><h3 class="pf-title">Etický kodex</h3></a>
                <a class="pf-card" href="certifikace.html"><h3 class="pf-title">Certifikace</h3></a>
              </div>
            </div>
          </div>
        </div>
        <!-- end links -->
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <p class="footer-copyright" id="footer-copyright"><!-- Dynamic content --></p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="../js/main.js" defer></script>
  <script src="/web4/js/projects-loader.js" defer></script>
  <script>
  // Project modal logic for references subpage
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('referencesModal');
    const closeBtn = document.getElementById('modalClose');
    const modalImg = document.getElementById('modalImage');
    const modalPrev = document.getElementById('modalPrev');
    const modalNext = document.getElementById('modalNext');
    const modalTitle = document.getElementById('modalTitle');
    const modalCategory = document.getElementById('modalCategory');
    const modalYear = document.getElementById('modalYear');
    const modalLocation = document.getElementById('modalLocation');
    const modalDescription = document.getElementById('modalDescription');
    let images = [], imgIdx = 0;

    function showModal(project) {
      if (project.images && Array.isArray(project.images) && project.images.length > 0) {
        images = project.images;
      } else if (project.image) {
        images = [project.image];
      } else if (project['data-images']) {
        try { images = JSON.parse(project['data-images']); } catch { images = []; }
      } else {
        images = [];
      }
      imgIdx = 0;
      updateModalImage();
      modalTitle.textContent = project.title || '';
      modalCategory.textContent = project.category || '';
      modalYear.textContent = project.year || '';
      modalLocation.textContent = project.location || '';
      modalDescription.textContent = project.description || '';
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function updateModalImage() {
      if (!images.length) return;
      modalImg.src = images[imgIdx];
      modalImg.alt = '';
    }
    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
    // Remove previous event listeners before adding new ones
    modalPrev.onclick = null;
    modalNext.onclick = null;
    closeBtn.onclick = null;

    modalPrev.addEventListener('click', function(e) {
      e.stopPropagation();
      if (!images.length) return;
      imgIdx = (imgIdx - 1 + images.length) % images.length;
      updateModalImage();
    });
    modalNext.addEventListener('click', function(e) {
      e.stopPropagation();
      if (!images.length) return;
      imgIdx = (imgIdx + 1) % images.length;
      updateModalImage();
    });
    closeBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      closeModal();
    });
    modal.addEventListener('click', e => {
      if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', e => {
      if (!modal.classList.contains('active')) return;
      if (e.key === 'Escape') closeModal();
      if (e.key === 'ArrowLeft') modalPrev.click();
      if (e.key === 'ArrowRight') modalNext.click();
    });

    // Attach click handlers to project cards after projects are loaded
    function enableProjectClicks() {
      const grid = document.getElementById('projectsGrid');
      if (!grid) return;
      grid.querySelectorAll('.reference-card, .project-card, .card, .project').forEach(card => {
        card.style.cursor = 'pointer';
        card.onclick = function() {
          let project = null;
          if (card.dataset.project) {
            try { project = JSON.parse(card.dataset.project); } catch {}
          }
          if (!project) {
            project = {
              title: card.querySelector('.reference-title, .card-title')?.textContent || '',
              category: card.querySelector('.reference-category')?.textContent || '',
              year: card.querySelector('.reference-year')?.textContent || '',
              location: card.querySelector('.reference-location')?.textContent || '',
              description: card.querySelector('.reference-description')?.textContent || '',
              image: card.querySelector('img')?.src || '',
              images: undefined
            };
          }
          if (card.dataset.images) {
            try { project.images = JSON.parse(card.dataset.images); } catch {}
          }
          showModal(project);
        };
      });
    }
    // Patch: Add at least 3 images to the first 3 projects after cards are loaded
    function patchProjectImages() {
      const grid = document.getElementById('projectsGrid');
      if (!grid) return;
      const cards = grid.querySelectorAll('.reference-card, .project-card, .card, .project');
      // Example images, adjust paths as needed
      const imagesArr = [
        ["../fotky/energetika.png", "../fotky/energetika2.png", "../fotky/energetika3.png"],
        ["../fotky/stavba.png", "../fotky/stavba2.png", "../fotky/stavba3.png"],
        ["../fotky/tzb.png", "../fotky/prodejna.png", "../fotky/prodejna2.png"]
      ];
      for (let i = 0; i < 3 && i < cards.length; ++i) {
        cards[i].dataset.images = JSON.stringify(imagesArr[i]);
      }
    }

    // Wait for projects-loader.js to finish
    const observer = new MutationObserver(function() {
      patchProjectImages();
      enableProjectClicks();
    });
    const grid = document.getElementById('projectsGrid');
    if (grid) observer.observe(grid, { childList: true, subtree: true });
    patchProjectImages();
    enableProjectClicks();
  });
  </script>
</body>
</html>
