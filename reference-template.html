<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reference detail</title>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/references.css" />
</head>
<body>

  <header class="header" data-header>
    <a href="references.html" class="back-arrow" style="position:absolute;top:18px;left:18px;z-index:200;display:flex;align-items:center;text-decoration:none;color:inherit;font-size:2rem;">
  <ion-icon name="arrow-back-outline" style="font-size:2.2rem;margin-right:6px;color:#fff;"></ion-icon>
  <span style="font-size:1.1rem;color:#fff;">Zpět na Reference</span>
    </a>
    <!-- ...existing code... -->
    <div class="nav-divider" style="width:3px;height:32px;background:linear-gradient(180deg,#66666696);margin:0 18px;align-self:center;border-radius:2px;"></div>
  </header>

  <main>
    <!-- Hero with background -->
    <section class="ref-hero">
      <div class="ref-hero-bg" id="ref-hero-bg"></div>
      <div class="container ref-hero-inner">
        <nav class="ref-breadcrumb">
          <a href="projects.html" class="ref-breadcrumb-link ref-breadcrumb-main">Reference</a>
          <span class="sep">›</span>
          <span class="ref-breadcrumb-current" id="ref-title-crumb"></span>
        </nav>
        <span id="ref-category" class="ref-badge"></span>
        <h1 id="ref-title" class="ref-title"></h1>
        <div class="ref-meta">
          <span id="ref-location" class="ref-meta-item"></span>
          <span id="ref-year" class="ref-meta-item"></span>
        </div>
      </div>
    </section>

    <!-- Content layout -->
    <section class="ref-content">
      <div class="container ref-layout">
        <div class="ref-main">
          <div class="ref-image-wrap">
            <img id="ref-image" class="ref-image" alt="Reference" />
          </div>
        </div>
        <aside class="ref-sidebar">
          <div class="ref-specs card-base">
            <h3 class="ref-specs-title">Parametry projektu</h3>
            <ul class="ref-specs-list">
              <li><strong>Místo:</strong> <span id="ref-location-spec"></span></li>
              <li><strong>Rok:</strong> <span id="ref-year-spec"></span></li>
              <li><strong>Kategorie:</strong> <span id="ref-category-spec"></span></li>
            </ul>
          </div>
          <div class="ref-description" id="ref-description"></div>
        </aside>
      </div>
    </section>
    <!-- Gallery Stripe Section (CSS Grid) -->
    <section class="section" style="padding:2rem 0 3rem 0;">
  <h2 style="font-size:2.4rem; margin:0 0 1.5em; text-align:center; font-weight:900; letter-spacing:0.01em; text-shadow:0 2px 8px #eee; color:#222;">Galerie projektu</h2>
      <div id="project-gallery" class="grid" style="display:grid;grid-gap:30px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));grid-auto-rows:150px;grid-auto-flow:row dense;"></div>
      <style>
        .grid .item {position:relative;display:flex;flex-direction:column;justify-content:flex-end;box-sizing:border-box;background:#0c9a9a;color:#fff;grid-column-start:auto;grid-row-start:auto;background-size:cover;background-position:center;box-shadow:-2px 2px 10px 0px rgba(68,68,68,0.15);transition:transform 0.3s;cursor:pointer;}
        .grid .item:after {content:'';position:absolute;width:100%;height:100%;background-color:black;opacity:0.3;transition:opacity 0.3s;left:0;top:0;}
        .grid .item:hover {transform:scale(1.05);}
        .grid .item:hover:after {opacity:0;}
        .grid .item--medium {grid-row-end:span 2;}
        .grid .item--large {grid-row-end:span 3;}
        .grid .item--full {grid-column-end:auto;}
        @media screen and (min-width:768px) {.grid .item--full{grid-column:1/-1;grid-row-end:span 2;}}
        .item__details {position:relative;z-index:1;padding:15px;color:#444;background:#fff;text-transform:lowercase;letter-spacing:1px;color:#828282;}
      </style>
      <script>
      // Dynamic gallery loader for reference-template
      (async function() {
        function log(msg) { if (window.console) console.log('[Gallery]', msg); }
        // Get selected reference slug from sessionStorage or URL
        let refSlug = null;
        // Try sessionStorage first
        let ref = null;
        try { ref = JSON.parse(sessionStorage.getItem('selectedReference')); } catch {}
        if (ref && ref.title) {
          refSlug = (ref.title||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        }
        // Fallback: get slug from URL (?ref=...)
        if (!refSlug) {
          const params = new URLSearchParams(window.location.search);
          const urlSlug = params.get('ref');
          if (urlSlug) refSlug = urlSlug.toLowerCase();
        }
        if (!refSlug) {
          log('No reference slug found in sessionStorage or URL.');
          return;
        }
        // Fetch references.json
        let db = null;
        try {
          const res = await fetch('./data/references.json');
          db = await res.json();
        } catch (e) {
          log('Failed to load references.json: ' + e);
          return;
        }
        if (!db || !Array.isArray(db.projects)) {
          log('No projects array in references.json');
          return;
        }
        // Find project by slug (case-insensitive)
        const slug = (str) => (str||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        const project = db.projects.find(p => slug(p.title) === refSlug);
        const gallery = document.getElementById('project-gallery');
        if (!gallery) {
          log('No #project-gallery element found');
          return;
        }
        if (!project) {
          gallery.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#888;font-size:1.2em;">Galerie nenalezena pro tento projekt.</div>';
          log('No matching project for slug: ' + refSlug);
          return;
        }
        if (!Array.isArray(project.gallery) || project.gallery.length === 0) {
          gallery.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#888;font-size:1.2em;">Žádné obrázky v galerii.</div>';
          log('No images in gallery for project: ' + project.title);
          return;
        }
        // Render gallery with alternating sizes
        gallery.innerHTML = project.gallery.map((img, index) => {
          // Alternate between different sizes for visual interest
          let sizeClass = '';
          if (index % 7 === 0) sizeClass = 'item--large';
          else if (index % 3 === 0) sizeClass = 'item--medium';
          return `<div class="item ${sizeClass}" style="background:url('${img}') center/cover no-repeat;"></div>`;
        }).join('');
        log('Gallery loaded for project: ' + project.title);
      })();
      </script>
    </section>
    <!-- Related references placeholder -->
    <section class="references compact" id="more-references">
      <div class="container">
        <h2 class="h2 section-title">Další projekty</h2>
        <div class="references-grid" id="ref-related-grid">
          <!-- Cards will be loaded dynamically by JS, matching the main gallery style -->
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-top">
      <div class="container">
        <div class="footer-brand">
          <a href="#" class="logo"><img id="footer-logo" src="" alt="UCHYTIL s.r.o."></a>
        </div>

        <!-- Replace the contact table with prefooter content -->
        <div class="footer-links">
          <div class="prefooter-groups">
            <div class="pf-group">
              <div class="pf-group-title">naše podstránky</div>
              <div class="pf-list">
                <a class="pf-card" href="aboutus.html"><h3 class="pf-title">O nás</h3></a>
                <a class="pf-card" href="projects.html"><h3 class="pf-title">Reference</h3></a>
                <a class="pf-card" href="contact-us.html"><h3 class="pf-title">Kontakty</h3></a>
                <a class="pf-card" href="eshop.html"><h3 class="pf-title">E‑Shop</h3></a>
                <a class="pf-card" href="division-template.html?division=energetika"><h3 class="pf-title">Divize</h3></a>
              </div>
            </div>
            <div class="pf-group">
              <div class="pf-group-title">jiné</div>
              <div class="pf-list">
                <a class="pf-card" href="ethics-code.html"><h3 class="pf-title">Etický kodex</h3></a>
                <a class="pf-card" href="certifikace.html"><h3 class="pf-title">Certifikace</h3></a>
              </div>
            </div>
          </div>
        </div>
        <!-- end replaced column -->
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <p class="footer-copyright" id="footer-copyright"><!-- Dynamic content --></p>
      </div>
    </div>
  </footer>

  <script src="./js/content-loader.js" defer></script>
</body>
</html>